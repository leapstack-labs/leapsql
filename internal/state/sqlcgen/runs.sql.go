// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: runs.sql

package sqlcgen

import (
	"context"
	"time"
)

const completeRun = `-- name: CompleteRun :exec
UPDATE runs
SET status = ?, completed_at = ?, error = ?
WHERE id = ?
`

type CompleteRunParams struct {
	Status      string     `json:"status"`
	CompletedAt *time.Time `json:"completed_at"`
	Error       *string    `json:"error"`
	ID          string     `json:"id"`
}

func (q *Queries) CompleteRun(ctx context.Context, arg CompleteRunParams) error {
	_, err := q.db.ExecContext(ctx, completeRun,
		arg.Status,
		arg.CompletedAt,
		arg.Error,
		arg.ID,
	)
	return err
}

const createRun = `-- name: CreateRun :one
INSERT INTO runs (id, environment, status, started_at)
VALUES (?, ?, ?, ?)
RETURNING id, environment, status, started_at, completed_at, error
`

type CreateRunParams struct {
	ID          string    `json:"id"`
	Environment string    `json:"environment"`
	Status      string    `json:"status"`
	StartedAt   time.Time `json:"started_at"`
}

func (q *Queries) CreateRun(ctx context.Context, arg CreateRunParams) (Run, error) {
	row := q.db.QueryRowContext(ctx, createRun,
		arg.ID,
		arg.Environment,
		arg.Status,
		arg.StartedAt,
	)
	var i Run
	err := row.Scan(
		&i.ID,
		&i.Environment,
		&i.Status,
		&i.StartedAt,
		&i.CompletedAt,
		&i.Error,
	)
	return i, err
}

const getLatestRun = `-- name: GetLatestRun :one
SELECT id, environment, status, started_at, completed_at, error
FROM runs
WHERE environment = ?
ORDER BY started_at DESC
LIMIT 1
`

func (q *Queries) GetLatestRun(ctx context.Context, environment string) (Run, error) {
	row := q.db.QueryRowContext(ctx, getLatestRun, environment)
	var i Run
	err := row.Scan(
		&i.ID,
		&i.Environment,
		&i.Status,
		&i.StartedAt,
		&i.CompletedAt,
		&i.Error,
	)
	return i, err
}

const getRun = `-- name: GetRun :one
SELECT id, environment, status, started_at, completed_at, error
FROM runs
WHERE id = ?
`

func (q *Queries) GetRun(ctx context.Context, id string) (Run, error) {
	row := q.db.QueryRowContext(ctx, getRun, id)
	var i Run
	err := row.Scan(
		&i.ID,
		&i.Environment,
		&i.Status,
		&i.StartedAt,
		&i.CompletedAt,
		&i.Error,
	)
	return i, err
}
